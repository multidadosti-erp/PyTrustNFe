<envioLote versao="1.0">
    <CNPJ>{{ rps.prestador.cnpj }}</CNPJ>
    <dhTrans>{{ rps.data_emissao }}</dhTrans>
    <NFS-e>
        <InfRps versao="1.1">
            <Id>
                <cNFS-e>{{ rps.id.cod_nfse }}</cNFS-e>
                <mod>{{ rps.id.mod }}</mod>
                <serie>{{ rps.id.serie }}</serie>
                <nNFS-e>{{ rps.id.numero_nfse }}</nNFS-e>
                <dEmi>{{ rps.id.data_emi }}</dEmi>
                <hEmi>{{ rps.id.hora_emi }}</hEmi>
                <tpNF>{{ rps.id.tp_fatura }}</tpNF>
                <refNF>{{ rps.id.ref_nf }}</refNF>
                <tpImp>{{ rps.id.tp_impressao }}</tpImp>
                <tpEmis>{{ rps.id.tp_emissao }}</tpEmis>
                <canhoto>{{ rps.id.canhoto }}</canhoto>
                <ambienteEmi>{{ rps.id.ambiente }}</ambienteEmi>
                <formaEmi>{{ rps.id.forma_emissao }}</formaEmi>
                <empreitadaGlobal>{{ rps.id.empreitada_global }}</empreitadaGlobal>
            </Id>
            <prestador>
                <CNPJ>{{ rps.prestador.cnpj }}</CNPJ>
                <xNome>{{ rps.prestador.nome }}</xNome>
                <xFant>{{ rps.prestador.nome_fant }}</xFant>
                <IM>{{ rps.prestador.insc_mun }}</IM>
                <xEmail>{{ rps.prestador.email }}</xEmail>
                <xSite>{{ rps.prestador.site }}</xSite>
                <end>
                    <xLgr>{{ rps.prestador.end.logradouro }}</xLgr>
                    <nro>{{ rps.prestador.end.numero }}</nro>
                    <xCpl>{{ rps.prestador.end.complemento }}</xCpl>
                    <xBairro>{{ rps.prestador.end.bairro }}</xBairro>
                    <cMun>{{ rps.prestador.end.cod_municipio }}</cMun>
                    <xMun>{{ rps.prestador.end.nome_municipio }}</xMun>
                    <UF>{{ rps.prestador.end.uf }}</UF>
                    <CEP>{{ rps.prestador.end.cep }}</CEP>
                    <cPais>{{ rps.prestador.end.cod_pais }}</cPais>
                    <xPais>{{ rps.prestador.end.nome_pais }}</xPais>
                </end>
                <fone>{{ rps.prestador.telefone }}</fone>
                <IE>{{ rps.prestador.insc_est }}</IE>
                <regimeTrib>{{ rps.prestador.reg_tribut }}</regimeTrib>
            </prestador>
            <TomS>
                {% if rps.tomador.tipo_cpfcnpj is defined %}
                <CNPJ>{{ rps.tomador.cnpj_cpf }}</CNPJ>
                {% else %}
                <CPF>{{ rps.tomador.cnpj_cpf }}</CPF>
                {% endif %}
                <xNome>{{ rps.tomador.nome }}</xNome>
                <ender>
                    <xLgr>{{ rps.tomador.end.logradouro }}</xLgr>
                    <nro>{{ rps.tomador.end.numero }}</nro>
                    <xCpl>{{ rps.tomador.end.complemento }}</xCpl>
                    <xBairro>{{ rps.tomador.end.bairro }}</xBairro>
                    <cMun>{{ rps.tomador.end.cod_municipio }}</cMun>
                    <xMun>{{ rps.tomador.end.nome_municipio }}</xMun>
                    <UF>{{ rps.tomador.end.uf }}</UF>
                    <CEP>{{ rps.tomador.end.cep }}</CEP>
                    <cPais>{{ rps.tomador.end.cod_pais }}</cPais>
                    <xPais>{{ rps.tomador.end.nome_pais }}</xPais>
                </ender>
                <xEmail>{{ rps.tomador.email }}</xEmail>
                <IE>{{ rps.tomador.insc_est }}</IE>
                <IM>{{ rps.tomador.insc_mun }}</IM>
                <fone>{{ rps.tomador.telefone }}</fone>
                <fone2>{{ rps.tomador.telefone2 }}</fone2>
            </TomS>
            {% if rps.obra is defined %}
            <dadosDaObra>
                <xLogObra>{{ rps.obra.logradouro }}</xLogObra>
                <xComplObra>{{ rps.obra.cmpl }}</xComplObra>
                <vNumeroObra>{{ rps.obra.numero }}</vNumeroObra>
                <xBairroObra>{{ rps.obra.bairro }}</xBairroObra>
                <xCepObra>{{ rps.obra.cep }}</xCepObra>
                <cCidadeObra>{{ rps.obra.cod_cidade }}</cCidadeObra>
                <xCidadeObra>{{ rps.obra.nome_cidade }}</xCidadeObra>
                <xUfObra>{{ rps.obra.uf }}</xUfObra>
                <cPaisObra>{{ rps.obra.codigo_pais }}</cPaisObra>
                <xPaisObra>{{ rps.obra.nome_pais }}</xPaisObra>
                <numeroArt>{{ rps.obra.numero_art }}</numeroArt>
                <numeroCei>{{ rps.obra.numero_cei }}</numeroCei>
                <numeroProj>{{ rps.obra.numero_proj }}</numeroProj>
                <numeroMatri>{{ rps.obra.numero_matri }}</numeroMatri>
            </dadosDaObra>
            {% endif %}
            {% if rps.transportador is defined %}
            <transportadora>
                <xNomeTrans>{{ rps.transportador.nome }}</xNomeTrans>
                <xCpfCnpjTrans>{{ rps.transportadora.cpf_cnpj }}</xCpfCnpjTrans>
                <xInscEstTrans>{{ rps.transportador.insc_est }}</xInscEstTrans>
                <xPlacaTrans>{{ rps.transportadora.placa }}</xPlacaTrans>
                <xEndTrans>{{ rps.transportadora.end }}</xEndTrans>
                <cMunTrans>{{ rps.transportadora.cod_municipio }}</cMunTrans>
                <xMunTrans>{{ rps.transportadora.nome_municipio }}</xMunTrans>
                <xUfTrans>{{ rps.transportadora.uf }}</xUfTrans>
                <cPaisTrans>{{ rps.transportadora.cod_pais }}</cPaisTrans>
                <xPaisTrans>{{ rps.transportadora.nome_pais }}</xPaisTrans>
                <vTipoFreteTrans>{{ rps.transportadora.tipo_frete }}</vTipoFreteTrans>
            </transportadora>
            {% endif %}
            {% for det in rps.det_lista -%}
            <det>
                <nItem>{{ det.numero_item }}</nItem>
                <serv>
                    <cServ>{{ det.serv.cod }}</cServ>
                    {% if det.serv.cod_lc is defined %}
                    <cLCServ>{{ det.serv.cod_lc }}</cLCServ>
                    {% endif %}
                    <xServ>{{ det.serv.nome }}</xServ>
                    {% if det.serv.local_tributacao is defined %}
                    <localTributacao>{{ det.serv.local_tributacao }}</localTributacao>
                    {% endif %}
                    <!-- <localVerifResServ>{{ det.serv.local_verif_res }}</localVerifResServ> -->
                    <uTrib>{{ det.serv.unid_trib }}</uTrib>
                    <qTrib>{{ det.serv.quant_trib }}</qTrib>
                    <vUnit>{{ det.serv.valor_unitario }}</vUnit>
                    <vServ>{{ det.serv.valor_servico }}</vServ>
                    <!-- <vDesc>{{ det.serv.valor_desconto }}</vDesc> -->
                    <vBCISS>{{ det.serv.base_calculo_iss }}</vBCISS>
                    <pISS>{{ det.serv.aliquota_iss }}</pISS>
                    <vISS>{{ det.serv.valor_iss }}</vISS>
                    <vBCINSS>{{ det.serv.base_calculo_inss }}</vBCINSS>
                    <pRetINSS>{{ det.serv.aliquota_retencao_inss }}</pRetINSS>
                    <vRetINSS>{{ det.serv.valor_retencao_inss }}</vRetINSS>
                    <vRed>{{ det.serv.reducao_base_calculo_iss }}</vRed>
                    <vBCRetIR>{{ det.serv.base_calculo_retencao_ir }}</vBCRetIR>
                    <pRetIR>{{ det.serv.aliquota_retencao_ir }}</pRetIR>
                    <vRetIR>{{ det.serv.valor_retencao_ir }}</vRetIR>
                    <vBCCOFINS>{{ det.serv.base_calculo_cofins }}</vBCCOFINS>
                    <pRetCOFINS>{{ det.serv.aliquota_retencao_cofins }}</pRetCOFINS>
                    <vRetCOFINS>{{ det.serv.valor_retencao_cofins }}</vRetCOFINS>
                    <vBCCSLL>{{ det.serv.base_calculo_csll }}</vBCCSLL>
                    <pRetCSLL>{{ det.serv.aliquota_retencao_csll }}</pRetCSLL>
                    <vRetCSLL>{{ det.serv.valor_retencao_csll }}</vRetCSLL>
                    <vBCPISPASEP>{{ det.serv.base_calculo_pis }}</vBCPISPASEP>
                    <pRetPISPASEP>{{ det.serv.aliquota_retencao_pis }}</pRetPISPASEP>
                    <vRetPISPASEP>{{ det.serv.valor_retencao_pis }}</vRetPISPASEP>
                </serv>
            </det>
    {% endfor %}
            <total>
                <vServ>{{ rps.total.valor_servico }}</vServ>
                <vDesc>{{ rps.total.valor_desconto }}</vDesc>
                <vtNF>{{ rps.total.valor_fatura }}</vtNF>
                <vtLiq>{{ rps.total.valor_liquido }}</vtLiq>
                <Ret>
                    <vRetIR>{{ rps.total.ret.valor_retencao_ir }}</vRetIR>
                    <vRetPISPASEP>{{ rps.total.ret.valor_retencao_pis }}</vRetPISPASEP>
                    <vRetCOFINS>{{ rps.total.ret.valor_retencao_cofins }}</vRetCOFINS>
                    <vRetCSLL>{{ rps.total.ret.valor_retencao_csll }}</vRetCSLL>
                    <vRetINSS>{{ rps.total.ret.valor_retencao_inss }}</vRetINSS>
                </Ret>
                <vtLiqFaturas>{{ rps.total.valor_liquido_total }}</vtLiqFaturas>
                <ISS>
                    <vBCISS>{{ rps.total.iss.base_calculo }}</vBCISS>
                    <vISS>{{ rps.total.iss.valor }}</vISS>
                </ISS>
            </total>
    {% if rps.faturas is defined %}
            <faturas>
                <fat>
                    <nItem>{{ rps.faturas.fat.numero_item }}</nItem>
                    <nFat>{{ rps.faturas.fat.numero_fatura }}</nFat>
                    <dVenc>{{ rps.faturas.fat.data_vencimento }}</dVenc>
                    <vFat>{{ rps.faturas.fat.valor_faturas }}</vFat>
                </fat>
            </faturas>
    {% endif %}
            <infAdicLT>{{ rps.inf_adicional_local_trib }}</infAdicLT>
    {% if rps.inf_adicional_exp_servico is defined %}
            <infAdicES>{{ rps.inf_adicional_exp_servico }}</infAdicES>
    {% endif %}
    {% if rps.inf_adicional is defined %}
            <infAdic>{{ rps.inf_adicional }}</infAdic>
    {% endif %}
        </InfRps>
    </NFS-e>
</envioLote>